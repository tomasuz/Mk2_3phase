# EV Charger Automation based on Nord Pool prices
# This file is suitable for !include_dir_merge_list
# Turning ON ev charger simply when price is low by price cap

# Automation: EV Charger - Turn ON when price < low_energy_price_cap
- id: ev_charger_turn_on_low_price
  alias: "EV Charger - Turn ON when price < low_energy_price_cap"
  description: "Turns on EV charger when energy price is low"
  trigger:
    - platform: state
      entity_id: sensor.energy_price_total
    - platform: state
      entity_id: input_number.low_energy_price_cap
    - platform: homeassistant
      event: start
  condition:
    - condition: template
      value_template: "{{ states('sensor.energy_price_total') | float(0) < states('input_number.low_energy_price_cap') | float(0.10) }}"
    - condition: state
      entity_id: switch.ev_charger_ev_charger_switch
      state: "off"
  action:
    - service: switch.turn_on
      target:
        entity_id: switch.ev_charger_ev_charger_switch
    - service: logbook.log
      data:
        name: EV Charger
        message: "Turned ON - Price: {{ states('sensor.energy_price_total') | round(3) }} â‚¬/kWh"
        entity_id: switch.ev_charger_ev_charger_switch
  mode: single
